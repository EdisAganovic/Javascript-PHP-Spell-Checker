var sc=sc||{};sc.objectKeys=function(a){var b,c=[];if("object"!==typeof a)return!1;for(b in a)a.hasOwnProperty(b)&&c.push(b);return c};sc.trim=function(a){return a.toString().replace(/^\s+/,"").replace(/\s+$/,"")};sc.addEvent=function(a,b,c){"string"===typeof a&&(a=document.getElementById(a));a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)};sc.hasClass=function(a,b){return RegExp("(^| )"+b+"( |$)").test(a.className)};sc.addClass=function(a,b){sc.hasClass(a,b)||(a.className+=" "+b)};
sc.findIndex=function(a,b){var c,d;c=0;for(d=a.length;c<d;c++)if(a[c]==b)return c;return!1};sc.newXHR=function(){if(void 0!==typeof XMLHttpRequest)return new window.XMLHttpRequest;if(window.ActiveXObject)try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}};sc.evalJSON=function(a){var b={};if(!a||"string"!==typeof a)return!1;a=sc.trim(a);if(window.JSON&&window.JSON.parse)try{b=window.JSON.parse(a)}catch(c){return!1}return b};
sc.verifyElem=function(a){a.jquery?a=a[0]:"string"===typeof a&&(/^#.*/.test(a)&&(a=a.slice(1)),a=document.getElementById(a));if(!a||1!==a.nodeType)throw Error("Invalid element. Make sure the element you're passing exists.");"A"==a.nodeName.toUpperCase()&&sc.addEvent(a,"click",function(a){if(a&&a.preventDefault)a.preventDefault();else if(window.event)window.event.returnValue=false});return a};
sc.SpellChecker=function(a,b,c){a=sc.verifyElem(a);b=sc.verifyElem(b);if("string"!==typeof c)throw Error("Invalid URL. Make sure you're passing a string for the server URL paramter.");this._button=a;this._textField=b;this._serverURL=c;this._currentContextSentence=this._currentWord=this._wordKeys=this._wordObject=this._text=null;this._canUndo=!1;this._modal=this._overlay=this._undoPrevious=this._undoCurrent=null;this.enable()};
sc.SpellChecker.prototype={enable:function(){var a=this;a._createModal();sc.addEvent(a._button,"click",function(){a._openChecker()});sc.addEvent("spelling-ignore","click",function(){a._ignoreChange()});sc.addEvent("spell-change","click",function(){a._makeChange()});sc.addEvent("spell-close","click",function(){a._closeChecker()});sc.addEvent("spell-completed-close","click",function(){a._closeChecker()});sc.addEvent("spell-summary-close","click",function(){a._closeChecker()});sc.addEvent("spell-context",
"click",function(){document.getElementById("spelling-suggestions").selectedIndex=-1});sc.addEvent("spell-context","keyup",function(){var a=this.getElementsByTagName("span")[0];"undefined"!==a&&(a=a.firstChild,null!==a&&(a=a.nodeValue,a!=this._currentWord&&(document.getElementById("spell-current").value=a)))});sc.addEvent("spell-undo","click",function(){!1!==a._canUndo&&a._undoChange()});sc.addEvent("spell-current","keyup",function(){var a=this.value,c=document.getElementById("spell-context").getElementsByTagName("span"),
d,e;d=0;for(e=c.length;d<e;d++)c[d].innerHTML=a})},_openChecker:function(){this._text=this._textField.value;this._canUndo=!1;document.getElementById("spelling-inner").style.display="none";document.getElementById("spell-completed").style.display="none";document.getElementById("spell-summary").style.display="none";document.getElementById("spell-checking").style.display="block";this._overlay.style.display="block";this._modal.style.display="block";this._sendData()},_closeChecker:function(){this._overlay.style.display=
"none";this._modal.style.display="none";this._undoPrevious=this._undoCurrent=this._currentWord=this._wordKeys=this._wordObject=this._text=null},_ignoreChange:function(){var a=this._wordKeys,b=sc.findIndex(a,this._currentWord);!1!==b&&(a.splice(b,1),this._wordKeys=a,0<a.length?this._reviewSpelling():(document.getElementById("spelling-inner").style.display="none",document.getElementById("spell-summary").style.display="block"))},_makeChange:function(){var a=this._text,b=this._currentWord,c=RegExp(b,
"g"),d=document.getElementById("spelling-suggestions"),e=d.selectedIndex,f=this._wordKeys,g=sc.findIndex(f,b),d=-1<e?d.options[e].text:document.getElementById("spell-current").value,a=a.replace(c,d);this._text=this._textField.value=a;f.splice(g,1);this._wordKeys=f;0<f.length?this._reviewSpelling():(document.getElementById("spelling-inner").style.display="none",document.getElementById("spell-summary").style.display="block");this._undoPrevious=b;this._undoCurrent=d;this._canUndo=!0},_undoChange:function(){var a=
this._undoPrevious,b;b=this._text.replace(RegExp(this._undoCurrent,"g"),a);this._text=this._textField.value=b;this._currentWord=document.getElementById("spell-current").value=a;this._setSuggestionOptions();this._wordKeys.unshift(a);this._canUndo=!1;this._setContextBox()},_extractWords:function(a,b){var c=a.replace(/[^A-Za-z\s]/g,"").split(" "),c=sc.findIndex(c,b);return a.split(" ").splice(c,15).join(" ")},_setSuggestionOptions:function(){var a=this._wordObject,b=this._currentWord,c=document.getElementById("spelling-suggestions"),
a=a[b],d=a.length;c.options.length=0;if(!(1>d)){for(b=0;b<d;b++)c.options[b]=new Option(a[b],a[b]);c.selectedIndex=0}},_setContextBox:function(){var a=this._extractWords(this._text,this._currentWord),b=RegExp(this._currentWord,"g"),c=document.getElementById("spell-context"),a=a.replace(b,'<span class="word-highlight">'+this._currentWord+"</span>");c.innerHTML=a;c.getElementsByTagName("span");this._currentContextSentence=a},_reviewSpelling:function(){var a=this._wordObject,b=this._wordKeys[0];this._currentWord=
b;document.getElementById("spell-current").value=b;this._setSuggestionOptions(a,b);this._setContextBox()},_beginReview:function(a){!0===a.success&&(document.getElementById("spell-checking").style.display="none",a.errors&&!0===a.errors?(this._wordObject=a.words,this._wordKeys=a=sc.objectKeys(this._wordObject),document.getElementById("spelling-inner").style.display="block",this._reviewSpelling()):document.getElementById("spell-completed").style.display="block")},_handleXHR:function(a){200==a.status&&
(a=sc.trim(a.responseText),a=sc.evalJSON(a),!1!==a&&this._beginReview(a))},_sendData:function(){var a=this,b=a._serverURL,c=a._text,d=sc.newXHR(),c="text="+encodeURIComponent(c);d.open("POST",b,!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.send(c);d.onreadystatechange=function(){4==d.readyState&&a._handleXHR(d)}},_createModal:function(){var a=document.createElement("div"),b=document.createElement("div");sc.addClass(a,"spell-check-overlay");sc.addClass(b,"spell-wrap");
b.innerHTML='<div class="spell-header">Spell Check</div><div id="spelling-inner"><div class="clearleft">Not found in dictionary:</div><div class="clearleft bottom5"><input type="text" class="current" id="spell-current" /><button id="spelling-ignore" type="button">Ignore</button></div><div class="context" contenteditable="true" id="spell-context"></div><div class="clearleft top5">Suggestions:</div><div class="spell-suggest"><select size="8" id="spelling-suggestions"><option></option></select></div><div class="spell-changebtns"><button type="button" id="spell-change">Change</button><button type="button" id="spell-undo">Undo</button></div><hr /><div class="close-box"><button type="button" id="spell-close">Close</button></div></div><div id="spell-checking" class="spell-checking">Checking...</div><div id="spell-completed" class="spell-completed">Spell check completed.<br />No errors found.<br /><button type="button" id="spell-completed-close" class="top5">Close</button></div><div id="spell-summary" class="spell-completed">Spell check completed.<br /><br /><button id="spell-summary-close">OK</button></div>';
document.body.appendChild(a);document.body.appendChild(b);this._overlay=a;this._modal=b}};