/** Javascript/PHP Spell Checker v1.5 https://github.com/LPology/Javascript-PHP-Spell-Checker Copyright 2012-2013 LPology, LLC Released under the MIT license */
(function(g,f,C){var b=g.sc||{},m=/^\s+/,q=/\s+$/,u=/[^\s]+/,v=/[^\s]+$/,w=/[xy]/g,x=/&/g,y=/"/g,z=/'/g,A=/</g,B=/>/g,r=/^\w+$/,n={};b._=function(a){return f.getElementById(a)};b.objectKeys=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b};b.obj2string=function(a,d){var c=[],e;for(e in a)if(a.hasOwnProperty(e)){var s=d?d+"["+e+"]":e,f=a[e];c.push("object"===typeof f?b.obj2string(f,s):encodeURIComponent(s)+"="+encodeURIComponent(f))}return c.join("&")};b.extendObj=function(a,
b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};b.isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};b.contains=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};b.purge=function(a){var d=a.attributes,c,e;if(d)for(c=d.length-1;0<=c;c-=1)e=d[c].name,"function"===typeof a[e]&&(a[e]=null);if(d=a.childNodes)for(d=d.length,c=0;c<d;c+=1)b.purge(a.childNodes[c])};b.remove=function(a){a.parentNode&&(b.purge(a),a.parentNode.removeChild(a))};b.trim=function(a){return a.toString().replace(m,
"").replace(q,"")};b.getId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(w,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};b.addEvent=function(a,d,c){"string"===typeof a&&(a=f.getElementById(a));a.addEventListener?a.addEventListener(d,c,!1):a.attachEvent("on"+d,c);return function(){b.removeEvent(a,d,c)}};b.removeEvent=function(a,b,c){"string"===typeof a&&(a=f.getElementById(a));a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)};
b.newXHR=function(){if("undefined"!==typeof XMLHttpRequest)return new g.XMLHttpRequest;if(g.ActiveXObject)try{return new g.ActiveXObject("Microsoft.XMLHTTP")}catch(a){return!1}else return!1};b.encodeHTML=function(a){return String(a).replace(x,"&amp;").replace(y,"&quot;").replace(z,"&#39;").replace(A,"&lt;").replace(B,"&gt;")};b.parseJSON=function(a){if(!a)return!1;a=b.trim(a);if(g.JSON&&g.JSON.parse)try{return g.JSON.parse(a)}catch(d){return!1}return a&&/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,
"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?(new Function("return "+a))():!1};b.verifyElem=function(a){"undefined"!==typeof jQuery&&a instanceof jQuery?a=a[0]:"string"===typeof a&&("#"==a.charAt(0)&&(a=a.substr(1)),a=f.getElementById(a));if(!a||1!==a.nodeType)return!1;"A"==a.nodeName.toUpperCase()&&(a.style.cursor="pointer",b.addEvent(a,"click",function(a){a&&a.preventDefault?a.preventDefault():g.event&&(g.event.returnValue=
!1)}));return a};b.SpellChecker=function(a){var d=this;this._settings={action:"",button:"",textInput:"",name:"text",data:{},onOpen:function(a,b){},onClose:function(a,b){}};b.extendObj(this._settings,a);this._button=b.verifyElem(this._settings.button);this._textInput=b.verifyElem(this._settings.textInput);delete this._settings.button;if(!1===this._button)throw Error("Invalid button. Make sure the element you're passing exists.");if(!1===this._textInput)throw Error("Invalid text field. Make sure the element you're passing exists.");
this._closeOnEsc=function(a){27===a.keyCode&&d._closeChecker()};this.enable()};b.SpellChecker.prototype={enable:function(){var a=this,d,c;this._isOpen=!1;this._uId=b.getId();this._createHTML();d=b._("spell-current"+this._uId);c=b._("spell-context"+this._uId);this._button.className+=" spellcheck-trigger";this._button.off=b.addEvent(this._button,"click",function(){a._openChecker()});b.addEvent("spelling-ignore"+this._uId,"click",function(){a._ignoreChange()});b.addEvent("spelling-ignore-all"+this._uId,
"click",function(){a._ignoreChange(!0)});b.addEvent("spell-change"+this._uId,"click",function(){a._makeChange()});b.addEvent("spell-change-all"+this._uId,"click",function(){a._makeChange(!0)});b.addEvent("spell-close"+this._uId,"click",function(){a._closeChecker()});b.addEvent("spell-msg-close"+this._uId,"click",function(){a._closeChecker()});b.addEvent("spell-undo"+this._uId,"click",function(){a._canUndo&&a._undoChange()});b.addEvent(d,"click",function(){b._("spelling-suggestions"+a._uId).selectedIndex=
-1});b.addEvent(c,"click",function(){b._("spelling-suggestions"+a._uId).selectedIndex=-1});b.addEvent(d,"keyup",function(){var a=c.getElementsByTagName("span")[0];a&&a.firstChild&&(a.firstChild.nodeValue=this.value)});b.addEvent(c,"keyup",function(){var a=this.getElementsByTagName("span")[0];a&&a.firstChild&&(d.value=a.firstChild.nodeValue)})},destroy:function(){this._isOpen&&this._closeChecker();this._button.off&&this._button.off();this._button.className=this._button.className.replace(/(?:^|\s)spellcheck-trigger(?!\S)/,
"");b.remove(b._("spell-msg"+this._uId));b.remove(b._("spell-modal"+this._uId));b.remove(b._("spell-overlay"+this._uId));b.remove(b._("spell-hidden"+this._uId));for(var a in this)this.hasOwnProperty(a)&&delete this.prop},_getRegex:function(a){n[a]||(n[a]=RegExp(a,"g"));return n[a]},_openChecker:function(){this._isOpen||(this._text=this._textInput.value,b._("spell-undo"+this._uId).disabled=!0,b._("spell-overlay"+this._uId).style.display="block",b._("spell-modal"+this._uId).style.display="block",this._canUndo=
!1,this._isOpen=!0,b.addEvent(f,"keyup",this._closeOnEsc),this._notifyMsg("a"),this._sendData())},_closeChecker:function(){this._isOpen&&(b._("spell-msg"+this._uId).style.display="none",b._("spell-modal"+this._uId).style.cssText="z-index:4999; display:none;",b._("spell-overlay"+this._uId).style.display="none",b._("spell-current"+this._uId).value="",b._("spell-context"+this._uId).innerHTML="",b._("spelling-suggestions"+this._uId).options.length=0,this._text=this._wordObject=this._wordKeys=this._currentWord=
this._wordMatches=this._matchOffset=this._canUndo=this._undoPrevious=this._previousWordMatches=this._previousMatchOffset=this._isOpen=null,b.removeEvent(f,"keyup",this._closeOnEsc),this._settings.onClose.call(this,this._button,this._textInput.value))},_showReviewer:function(){b._("spell-msg"+this._uId).style.display="none";b._("spell-modal"+this._uId).style.zIndex=5001},_notifyMsg:function(a){var d,c=b._("spell-msg-close-box"+this._uId);"a"==a?(d="Checking...",c.style.display="none"):c.style.display=
"block";"b"==a&&(d="We experienced an error and were unable to complete the spell check.");"c"==a&&(d="Spell check completed. No errors found.");"d"==a&&(d="Spell check completed");b._("spell-modal"+this._uId).style.zIndex=4999;b._("spell-msg-text"+this._uId).innerHTML=d;b._("spell-msg"+this._uId).style.display="block";"a"!=a&&b._("spell-msg-close"+this._uId).focus()},_ignoreChange:function(a){var d=this._wordMatches,c=this._matchOffset;!0===a||1>=d||c===d?(this._wordKeys.splice(0,1),this._matchOffset=
1,a=!1):(this._matchOffset=c+1,a=!0);b._("spell-undo"+this._uId).disabled=!0;this._canUndo=!1;0<this._wordKeys.length||!0===a?this._reviewWord():this._notifyMsg("d")},_makeChange:function(a){var d=this._text,c=this._currentWord,e=this._wordMatches,f=this._matchOffset,g=b._("spelling-suggestions"+this._uId),m=this._getRegex(c),p=g.selectedIndex,t=0,k;b._("spell-hidden"+this._uId).value=d;this._undoPrevious=c;this._previousWordMatches=e;this._previousMatchOffset=f;b._("spell-undo"+this._uId).disabled=
!1;this._canUndo=!0;k=-1<p?g.options[p].text:b._("spell-current"+this._uId).value;d=d.replace(m,function(b){t++;return!0===a||f===t?k:b});!0===a||1>=e||f===e?(this._wordKeys.splice(0,1),this._matchOffset=1,e=!1):e=!0;this._textInput.value=this._text=d;0<this._wordKeys.length||!0===e?this._reviewWord():this._notifyMsg("d")},_undoChange:function(){var a=this._undoPrevious,d=b._("spell-hidden"+this._uId),c=d.value;this._text=this._textInput.value=c;this._currentWord=b._("spell-current"+this._uId).value=
a;b.contains(this._wordKeys,a)||this._wordKeys.unshift(a);this._wordMatches=this._previousWordMatches;this._matchOffset=this._previousMatchOffset;this._canUndo=!1;b._("spell-undo"+this._uId).disabled=!0;d.value="";this._setSuggestionOptions();this._setContextBox()},_setSuggestionOptions:function(){var a=this._wordObject,d=this._currentWord,c=b._("spelling-suggestions"+this._uId),a=a[d],d=a.length,e;c.options.length=0;if(!(1>d)){for(e=0;e<d;e++)c.options[e]=new Option(a[e],a[e]);c.selectedIndex=0}},
_setContextBox:function(){var a=this._currentWord,d=a.length,c=this._matchOffset,e=this._getRegex(a),f=this._text,g=f.length,n=b._("spell-context"+this._uId),p=0;f.replace(e,function(e,k){if(r.test(f.substr(k+d,1)))return e;p++;if(p===c){var l,h;l=k-20;h=k+d;l=0>l?f.substr(0,k):f.substr(l,20);h=h+50>g?f.substr(h):f.substr(h,50);l=l.replace(m,"").replace(u,"").replace(m,"");h=h.replace(q,"").replace(v,"").replace(q,"");n.innerHTML=b.encodeHTML(l)+'<span class="word-highlight">'+b.encodeHTML(a)+"</span>"+
b.encodeHTML(h)}return e})},_reviewWord:function(){var a=this._wordKeys[0];this._currentWord=a;b._("spell-current"+this._uId).value=a;this._wordMatches=this._getTotalWordMatches();this._setSuggestionOptions();this._setContextBox()},_getTotalWordMatches:function(){var a=this._getRegex(this._currentWord),b=this._currentWord.length,c=0,e=this._text;this._text.replace(a,function(a,f){r.test(e.substr(f+b,1))||c++;return a});return c},_begin:function(a){a.success&&!0===a.success&&(a.errors&&!0===a.errors?
(b._("spell-hidden"+this._uId).value=this._text,this._canUndo=!1,this._wordObject=a.words,this._wordKeys=b.objectKeys(this._wordObject),this._matchOffset=1,this._showReviewer(),this._reviewWord()):this._notifyMsg("c"))},_handleXHR:function(a){a=b.parseJSON(a);!1!==a?this._begin(a):this._notifyMsg("b")},_sendData:function(){var a=this,d=b.newXHR(),c;!1===d?this._notifyMsg("b"):2>this._text.length?this._notifyMsg("c"):(c=encodeURIComponent(this._settings.name)+"=",c+=encodeURIComponent(this._text),
b.isEmpty(this._settings.data)||(c=c+"&"+b.obj2string(this._settings.data)),d.onreadystatechange=function(){4===this.readyState&&(200<=this.status&&300>this.status?(a._settings.onOpen.call(a,a._button,a._text),a._handleXHR(this.responseText)):a._notifyMsg("b"))},d.open("POST",this._settings.action,!0),d.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),
d.send(c),d=null)},_createHTML:function(){var a=f.createElement("div"),b=f.createElement("div"),c=f.createElement("div"),e=f.createElement("textarea");f.body.appendChild(a);a.className="spell-check-overlay";a.id="spell-overlay"+this._uId;f.body.appendChild(b);b.className="spell-wrap";b.id="spell-modal"+this._uId;b.innerHTML='<div class="spell-header">Spell Check</div><div id="spelling-inner'+this._uId+'" class="spelling-inner"><div class="clearleft">Not found in dictionary:</div><div class="spell-nf"><input type="text" class="current" id="spell-current'+
this._uId+'" /><div class="context" contenteditable="true" id="spell-context'+this._uId+'"></div></div><div class="spell-ignorebtns"><button id="spelling-ignore'+this._uId+'" type="button">Ignore</button><button id="spelling-ignore-all'+this._uId+'" type="button">Ignore All</button></div><div class="clearleft">Suggestions:</div><div class="spell-suggest"><select size="8" id="spelling-suggestions'+this._uId+'"><option></option></select></div><div class="spell-changebtns"><button type="button" id="spell-change'+
this._uId+'">Change</button><button id="spell-change-all'+this._uId+'">Change All</button><button type="button" id="spell-undo'+this._uId+'">Undo</button></div><hr /><div class="close-box"><button type="button" id="spell-close'+this._uId+'">Close</button></div></div>';f.body.appendChild(c);c.className="spell-msg";c.id="spell-msg"+this._uId;c.innerHTML='<div class="spell-header">Spell Check</div><div class="spell-msg-inner"><span id="spell-msg-text'+this._uId+'"></span></div><div class="spell-msg-inner" id="spell-msg-close-box'+
this._uId+'"><button id="spell-msg-close'+this._uId+'">OK</button></div>';f.body.appendChild(e);e.style.display="none";e.id="spell-hidden"+this._uId}};g.sc=b})(window,document);