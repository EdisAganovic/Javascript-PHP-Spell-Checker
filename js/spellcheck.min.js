/** Javascript/PHP Spell Checker v1.5.3 https://github.com/LPology/Javascript-PHP-Spell-Checker Copyright 2012-2013 LPology, LLC Released under the MIT license */
(function(g,f,u){var d=g.sc||{},r=/^\s+/,s=/\s+$/,v=/[^\s]+/,w=/[^\s]+$/,x=/[xy]/g,y=/&/g,z=/"/g,A=/'/g,B=/</g,C=/>/g,t=/^\w+$/,m={},e=function(a){return f.getElementById(a)};d.objectKeys=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b};d.obj2string=function(a,b){var c=[],h;for(h in a)if(a.hasOwnProperty(h)){var e=b?b+"["+h+"]":h,p=a[h];c.push("object"===typeof p?d.obj2string(p,e):encodeURIComponent(e)+"="+encodeURIComponent(p))}return c.join("&")};d.extendObj=function(a,
b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};d.isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};d.contains=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};d.purge=function(a){var b=a.attributes,c,h;if(b)for(c=b.length-1;0<=c;c-=1)h=b[c].name,"function"===typeof a[h]&&(a[h]=null);if(b=a.childNodes)for(b=b.length,c=0;c<b;c+=1)d.purge(a.childNodes[c])};d.remove=function(a){a.parentNode&&(d.purge(a),a.parentNode.removeChild(a))};d.trim=function(a){return a.toString().replace(r,
"").replace(s,"")};d.getId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(x,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};d.addEvent=function(a,b,c){"string"===typeof a&&(a=f.getElementById(a));a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c);return function(){d.removeEvent(a,b,c)}};d.removeEvent=function(a,b,c){"string"===typeof a&&(a=f.getElementById(a));a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)};
d.newXHR=function(){if("undefined"!==typeof XMLHttpRequest)return new g.XMLHttpRequest;if(g.ActiveXObject)try{return new g.ActiveXObject("Microsoft.XMLHTTP")}catch(a){return!1}};d.encodeHTML=function(a){return String(a).replace(y,"&amp;").replace(z,"&quot;").replace(A,"&#39;").replace(B,"&lt;").replace(C,"&gt;")};d.parseJSON=function(a){if(!a)return!1;a=d.trim(a);if(g.JSON&&g.JSON.parse)try{return g.JSON.parse(a)}catch(b){return!1}return a&&/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,
"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?(new Function("return "+a))():!1};d.verifyElem=function(a){"undefined"!==typeof jQuery&&a instanceof jQuery?a=a[0]:"string"===typeof a&&("#"==a.charAt(0)&&(a=a.substr(1)),a=f.getElementById(a));if(!a||1!==a.nodeType)return!1;"A"==a.nodeName.toUpperCase()&&(a.style.cursor="pointer",d.addEvent(a,"click",function(a){a&&a.preventDefault?a.preventDefault():g.event&&(g.event.returnValue=
!1)}));return a};d.SpellChecker=function(a){var b=this;this._settings={action:"",button:"",textInput:"",name:"text",data:{},debug:!1,onOpen:function(a,b){},onClose:function(a,b){}};d.extendObj(this._settings,a);this._button=d.verifyElem(this._settings.button);this._textInput=d.verifyElem(this._settings.textInput);delete this._settings.button;if(!1===this._button)throw Error("Invalid button. Make sure the element you're passing exists.");if(!1===this._textInput)throw Error("Invalid text field. Make sure the element you're passing exists.");
this._closeOnEsc=function(a){27===a.keyCode&&b._closeChecker()};this.enable()};d.SpellChecker.prototype={enable:function(){var a=this,b,c;this._isOpen=!1;this._uId=d.getId();this._createHTML();b=e("spell-current"+this._uId);c=e("spell-context"+this._uId);this._button.className+=" spellcheck-trigger";this._button.off=d.addEvent(this._button,"click",function(){a._openChecker()});d.addEvent("spelling-ignore"+this._uId,"click",function(){a._ignore()});d.addEvent("spelling-ignore-all"+this._uId,"click",
function(){a._ignore(!0)});d.addEvent("spell-change"+this._uId,"click",function(){a._makeChange()});d.addEvent("spell-change-all"+this._uId,"click",function(){a._makeChange(!0)});d.addEvent("spell-close"+this._uId,"click",function(){a._closeChecker()});d.addEvent("spell-msg-close"+this._uId,"click",function(){a._closeChecker()});d.addEvent("spell-undo"+this._uId,"click",function(){a._undoChange()});d.addEvent(b,"click",function(){e("spelling-suggestions"+a._uId).selectedIndex=-1});d.addEvent(c,"click",
function(){e("spelling-suggestions"+a._uId).selectedIndex=-1});d.addEvent(b,"keyup",function(){var a=c.getElementsByTagName("span")[0];a&&a.firstChild&&(a.firstChild.nodeValue=this.value)});d.addEvent(c,"keyup",function(){var a=this.getElementsByTagName("span")[0];a&&a.firstChild&&(b.value=a.firstChild.nodeValue)})},destroy:function(){this._isOpen&&this._closeChecker();this._button.off&&this._button.off();this._button.className=this._button.className.replace(/(?:^|\s)spellcheck-trigger(?!\S)/,"");
d.remove(e("spell-msg"+this._uId));d.remove(e("spell-modal"+this._uId));d.remove(e("spell-overlay"+this._uId));for(var a in this)this.hasOwnProperty(a)&&delete this.prop},log:function(a){this._settings.debug&&g.console&&console.log("[spell checker] "+a)},_getRegex:function(a){m[a]||(m[a]=RegExp(a,"g"));return m[a]},_openChecker:function(){this._isOpen||(e("spell-undo"+this._uId).disabled=!0,e("spell-overlay"+this._uId).style.display="block",e("spell-modal"+this._uId).style.display="block",this._text=
this._textInput.value,this._isOpen=!0,this._undo=[],d.addEvent(f,"keyup",this._closeOnEsc),this._notifyMsg("a"),this._sendData())},_closeChecker:function(){this._isOpen&&(e("spell-msg"+this._uId).style.display="none",e("spell-modal"+this._uId).style.cssText="z-index:4999; display:none;",e("spell-overlay"+this._uId).style.display="none",e("spell-current"+this._uId).value="",e("spell-context"+this._uId).innerHTML="",e("spelling-suggestions"+this._uId).options.length=0,this._text=this._wordObject=this._wordKeys=
this._currentWord=this._wordMatches=this._matchOffset=this._undo=this._isOpen=null,d.removeEvent(f,"keyup",this._closeOnEsc),this._settings.onClose.call(this,this._button,this._textInput.value))},_notifyMsg:function(a){var b,c=e("spell-msg-close-box"+this._uId);"a"==a?(b="Checking...",c.style.display="none"):c.style.display="block";"b"==a&&(b="We experienced an error and were unable to complete the spell check.");"c"==a&&(b="Spell check completed. No errors found.");"d"==a&&(b="Spell check completed");
e("spell-modal"+this._uId).style.zIndex=4999;e("spell-msg-text"+this._uId).innerHTML=b;e("spell-msg"+this._uId).style.display="block";"a"!=a&&e("spell-msg-close"+this._uId).focus()},_ignore:function(a){!0===a||1>=this._wordMatches||this._matchOffset===this._wordMatches?(this._wordKeys.splice(0,1),this._matchOffset=1,a=!1):(this._matchOffset++,a=!0);for(e("spell-undo"+this._uId).disabled=!0;0<this._undo.length;)this._undo.pop();0<this._wordKeys.length||!0===a?this._reviewWord():this._notifyMsg("d")},
_makeChange:function(a){var b=this._text,c=this._wordMatches,d=this._matchOffset,k=e("spelling-suggestions"+this._uId),p=this._getRegex(this._currentWord),f=k.selectedIndex,g=0,q;this._undo.unshift({text:b,word:this._currentWord,numMatches:this._wordMatches,matchOffset:this._matchOffset});e("spell-undo"+this._uId).disabled=!1;q=-1<f?k.options[f].text:e("spell-current"+this._uId).value;b=b.replace(p,function(b){g++;return!0===a||d===g?q:b});!0===a||1>=c||d===c?(this._wordKeys.splice(0,1),this._matchOffset=
1,c=!1):c=!0;this._textInput.value=this._text=b;0<this._wordKeys.length||!0===c?this._reviewWord():this._notifyMsg("d")},_undoChange:function(){var a=this._undo[0];this._textInput.value=this._text=a.text;e("spell-current"+this._uId).value=a.word;d.contains(this._wordKeys,a.word)||this._wordKeys.unshift(a.word);this._currentWord=a.word;this._wordMatches=a.numMatches;this._matchOffset=a.matchOffset;this._setSuggestionOptions();this._setContextBox();this._undo.splice(0,1);1>this._undo.length&&(e("spell-undo"+
this._uId).disabled=!0)},_setSuggestionOptions:function(){var a=e("spelling-suggestions"+this._uId),b=this._wordObject[this._currentWord],c=b.length,d;a.options.length=0;if(!(1>c)){for(d=0;d<c;d++)a.options[d]=new Option(b[d],b[d]);a.selectedIndex=0}},_setContextBox:function(){var a=this._currentWord,b=a.length,c=this._matchOffset,h=this._getRegex(a),k=this._text,f=k.length,g=e("spell-context"+this._uId),m=0;k.replace(h,function(e,h){if(t.test(k.substr(h+b,1)))return e;m++;if(m===c){var n,l;n=h-20;
l=h+b;n=0>n?k.substr(0,h):k.substr(n,20);l=l+50>f?k.substr(l):k.substr(l,50);n=n.replace(r,"").replace(v,"").replace(r,"");l=l.replace(s,"").replace(w,"").replace(s,"");g.innerHTML=d.encodeHTML(n)+'<span class="word-highlight">'+d.encodeHTML(a)+"</span>"+d.encodeHTML(l)}return e})},_reviewWord:function(){this._currentWord=this._wordKeys[0];e("spell-current"+this._uId).value=this._currentWord;this._wordMatches=this._getTotalWordMatches();this._setSuggestionOptions();this._setContextBox()},_getTotalWordMatches:function(){var a=
this._getRegex(this._currentWord),b=this._currentWord.length,c=0,d=this._text;this._text.replace(a,function(a,e){t.test(d.substr(e+b,1))||c++;return a});return c},_begin:function(a){a.success&&!0===a.success&&(a.errors&&!0===a.errors?(this._wordObject=a.words,this._wordKeys=d.objectKeys(this._wordObject),this._matchOffset=1,e("spell-msg"+this._uId).style.display="none",e("spell-modal"+this._uId).style.zIndex=5001,this._reviewWord()):this._notifyMsg("c"))},_sendData:function(){var a=this,b=d.newXHR(),
c,e;2>this._text.length?this._notifyMsg("c"):(c=encodeURIComponent(this._settings.name)+"=",c+=encodeURIComponent(this._text),d.isEmpty(this._settings.data)||(c=c+"&"+d.obj2string(this._settings.data)),e=function(){var c,f,g;try{if(e&&4===b.readyState&&(e=u,b.onreadystatechange=function(){},a._isOpen)){f=b.status;try{g=b.statusText}catch(m){g=""}a.log("Request completed. Status: "+f+" "+g);200<=f&&300>f?(c=d.parseJSON(b.responseText),!1!==c?(a._settings.onOpen.call(a,a._button,a._text),a._begin(c)):
(a.log("Error parsing server response"),a._notifyMsg("b")),b=c=null):a._notifyMsg("b")}}catch(q){a.log("Error: "+q.message),a._notifyMsg("b")}},b.onreadystatechange=e,b.open("POST",this._settings.action,!0),b.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),b.setRequestHeader("X-Requested-With","XMLHttpRequest"),b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.log("Sending data..."),b.send(c))},_createHTML:function(){var a=f.createElement("div"),
b=f.createElement("div"),c=f.createElement("div");f.body.appendChild(a);a.className="spell-check-overlay";a.id="spell-overlay"+this._uId;f.body.appendChild(b);b.className="spell-wrap";b.id="spell-modal"+this._uId;b.innerHTML='<div class="spell-header">Spell Check</div><div id="spelling-inner'+this._uId+'" class="spelling-inner"><div class="clearleft">Not found in dictionary:</div><div class="spell-nf"><input type="text" class="current" id="spell-current'+this._uId+'" /><div class="context" contenteditable="true" id="spell-context'+
this._uId+'"></div></div><div class="spell-ignorebtns"><button id="spelling-ignore'+this._uId+'" type="button">Ignore</button><button id="spelling-ignore-all'+this._uId+'" type="button">Ignore All</button></div><div class="clearleft">Suggestions:</div><div class="spell-suggest"><select size="8" id="spelling-suggestions'+this._uId+'"><option></option></select></div><div class="spell-changebtns"><button type="button" id="spell-change'+this._uId+'">Change</button><button id="spell-change-all'+this._uId+
'">Change All</button><button type="button" id="spell-undo'+this._uId+'">Undo</button></div><hr /><div class="close-box"><button type="button" id="spell-close'+this._uId+'">Close</button></div></div>';f.body.appendChild(c);c.className="spell-msg";c.id="spell-msg"+this._uId;c.innerHTML='<div class="spell-header">Spell Check</div><div class="spell-msg-inner"><span id="spell-msg-text'+this._uId+'"></span></div><div class="spell-msg-inner" id="spell-msg-close-box'+this._uId+'"><button id="spell-msg-close'+
this._uId+'">OK</button></div>'}};g.sc=d})(window,document);